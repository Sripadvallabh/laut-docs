Jinja
=====

If you have a jinja2 template and an YAML containing the values, you can apply the jinja2
template on any device using the '-j' argument to ``execute`` and ``configure`` commands.

Basic usage
-----------

It is easier to understand via an example using pagent traffic:

Below is a pagent traffic jinja2 template which can configure a simple traffic stream given L2 & L3
source & destination addresses:

.. code-block:: jinja

   {% if pagent is defined %}
       {% for name, attr in pagent.items() %}
           # Traffic stream {{ name }}
           tgn add IP
           tgn name {{ name }}
           tgn on
           {% if attr.rate is defined %}
               tgn rate {{ attr.rate }}
           {% else %}
               tgn rate 5
           {% endif %}
           {% if attr.l2_src is defined %}
               tgn L2-src-addr {{ attr.l2_src }}
           {% endif %}
           {% if attr.l2_dest is defined %}
               tgn L2-dest-addr {{ attr.l2_dest }}
           {% endif %}
           {% if attr.l3_src is defined %}
               {% if ':' in attr.l3_src %}
                   tgn Layer 3 ipv6
               {% else %}
                   tgn L3-version 4
               {% endif %}
               tgn L3-src-addr {{ attr.l3_src }}
           {% endif %}
           {% if attr.l3_dest is defined %}
               tgn L3-dest-addr {{ attr.l3_dest }}
           {% endif %}
       {% endfor %}
   {% endif %}

YAML containing values corresponding to a traffic stream named 'ff07::1' with its L2 & L3 packet
values:

.. code-block:: yaml

   pagent:
     'ff07::1':
       rate: 5
       l2_src: 5254.0001.9765
       l2_dest: 3333.0000.0001
       l3_src: 4000::2
       l3_dest: ff07::1

Applying the above jinja on a pagent device using ``execute``:

.. code-block:: console

   (lӓut-p225) execute -j pagent_jinja.j2 jinja_args.yaml
   
   2024-08-01 14:10:43,092: %UNICON-INFO: +++ p225 with via 'a': executing command '!' +++
   !
   p225#
   
   2024-08-01 14:10:43,234: %UNICON-INFO: +++ p225 with via 'a': executing command '!' +++
   !
   p225#
   
   2024-08-01 14:10:43,264: %UNICON-INFO: +++ p225 with via 'a': executing command '# Traffic stream ff07::1' +++
   # Traffic stream ff07::1
   p225#
   
   2024-08-01 14:10:43,366: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn add IP' +++
   tgn add IP
   p225#
   
   2024-08-01 14:10:43,469: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn name ff07::1' +++
   tgn name ff07::1
   p225#
   
   2024-08-01 14:10:43,571: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn on' +++
   tgn on
   p225#
   
   2024-08-01 14:10:43,674: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn rate 5' +++
   tgn rate 5
   p225#
   
   2024-08-01 14:10:43,776: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn L2-src-addr 5254.0001.9765' +++
   tgn L2-src-addr 5254.0001.9765
   p225#
   
   2024-08-01 14:10:43,868: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn L2-dest-addr 3333.0000.0001' +++
   tgn L2-dest-addr 3333.0000.0001
   p225#
   
   2024-08-01 14:10:43,970: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn Layer 3 ipv6' +++
   tgn Layer 3 ipv6
   p225#
   
   2024-08-01 14:10:44,073: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn L3-src-addr 4000::2' +++
   tgn L3-src-addr 4000::2
   p225#
   
   2024-08-01 14:10:44,175: %UNICON-INFO: +++ p225 with via 'a': executing command 'tgn L3-dest-addr ff07::1' +++
   tgn L3-dest-addr ff07::1
   p225#
   
   2024-08-01 14:10:44,278: %UNICON-INFO: +++ p225 with via 'a': executing command '!' +++
   !
   p225#

With both the jinja template and the value YAML passed as argument, jinja application is done
by LAUT to execute multiple commands easily.

Autogenerated blitz action snippet will contain all the commands executed via jinja application:

.. code-block:: console

   (lӓut-p225) list 1
   execute:
     device: p225
     command: |-
       !
       !
       # Traffic stream ff07::1
       tgn add IP
       tgn name ff07::1
       tgn on
       tgn rate 5
       tgn L2-src-addr 5254.0001.9765
       tgn L2-dest-addr 3333.0000.0001
       tgn Layer 3 ipv6
       tgn L3-src-addr 4000::2
       tgn L3-dest-addr ff07::1
       !
   (lӓut-p225)

Why jinja
---------

Jinja is easier to understand that a wide variety of commands/configurations because all one needs
to look at is the value YAML instead of the commands/configuration themselves. From the above
example it is much clear how looking at the pagent traffic YAML is easier to understand the
traffic flow instead of the commands observed from ``list 1``. Jinja application is also
much easier than manually adding them one by one which is prone to human error.
