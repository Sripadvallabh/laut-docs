
.. _blitz_section:

blitz_section
=============

.. warning::

   Use with caution. If you are unsure of what it does, better leave using it altogether.

Adds a new blitz test section.

All autogenerated blitz action snippets fall under a particular blitz test section.
So far, all of them were added under a test section called 'default' by LAUT itself.
Once we give the command ``blitz_section <SECTION_NAME>``, LAUT creates a new blitz test
section called 'SECTION_NAME' and starts adding new autogenerated blitz action snippets
under this new test section.

Following example shows how test sections work with different blitz actions generated for
different test sections:

.. code-block:: console

   (lӓut-l2switch) blitz_section a
   (lӓut-l2switch) configure no logging console
   2024-07-10 17:23:56: %LAUT-INFO: +..............................................................................+
   2024-07-10 17:23:56: %LAUT-INFO: :                 Configure 'no logging console' on 'l2switch'                 :
   2024-07-10 17:23:56: %LAUT-INFO: +..............................................................................+

   2024-07-10 17:23:56,641: %UNICON-INFO: +++ l2switch with via 'cli': configure +++
   config term
   Enter configuration commands, one per line.  End with CNTL/Z.
   l2switch(config)#no logging console
   l2switch(config)#end
   l2switch#
   (lӓut-l2switch) blitz_section b
   (lӓut-l2switch) configure no service internal
   2024-07-10 17:24:04: %LAUT-INFO: +..............................................................................+
   2024-07-10 17:24:04: %LAUT-INFO: :                Configure 'no service internal' on 'l2switch'                 :
   2024-07-10 17:24:04: %LAUT-INFO: +..............................................................................+

   2024-07-10 17:24:04,300: %UNICON-INFO: +++ l2switch with via 'cli': configure +++
   config term
   Enter configuration commands, one per line.  End with CNTL/Z.
   l2switch(config)#no service internal
   l2switch(config)#end
   l2switch#
   (lӓut-l2switch) blitz_section c
   (lӓut-l2switch) execute show ip route
   2024-07-10 17:24:12: %LAUT-INFO: +..............................................................................+
   2024-07-10 17:24:12: %LAUT-INFO: :                    Execute 'show ip route' on 'l2switch'                     :
   2024-07-10 17:24:12: %LAUT-INFO: +..............................................................................+

   2024-07-10 17:24:12,875: %UNICON-INFO: +++ l2switch with via 'cli': executing command 'show ip route' +++
   show ip route
   Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP
          D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area
          N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2
          E1 - OSPF external type 1, E2 - OSPF external type 2, m - OMP
          n - NAT, Ni - NAT inside, No - NAT outside, Nd - NAT DIA
          i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2
          ia - IS-IS inter area, * - candidate default, U - per-user static route
          H - NHRP, G - NHRP registered, g - NHRP registration summary
          o - ODR, P - periodic downloaded static route, l - LISP
          a - application route
          + - replicated route, % - next hop override, p - overrides from PfR
          & - replicated local route overrides by connected

   Gateway of last resort is not set

         5.0.0.0/32 is subnetted, 1 subnets
   C        5.5.5.5 is directly connected, Loopback0
   l2switch#
   Add INCLUDE section (y/n): n
   Add EXCLUDE section (y/n): n
   Add SAVE section (y/n): n
   (lӓut-l2switch) save pyats/testcases/TC1.yaml
   LAUT-INFO: File 'pyats/testcases/TC1.yaml' saved successfully

Observe below how the 3 different commands ``configure no logging console``,
``configure no service internal`` and ``execute show ip route`` under 3 different
test sections 'a', 'b', 'c' look in the final blitz testcase YAML:

.. code-block:: yaml

   # TC1.yaml
   # LAUT Generated testcase

   TC1:
       source:
           pkg: genie.libs.sdk
           class: triggers.blitz.blitz.Blitz
       devices: ['l2switch']
       test_sections:
           - a:
               - configure:
                   device: l2switch
                   command: ['no logging console']
           - b:
               - configure:
                   device: l2switch
                   command: ['no service internal']
           - c:
               - execute:
                   device: l2switch
                   command: ['show ip route']

Hence, test sections essentially isolate a group of blitz actions that all perform one common
task in a testcase which would make a blitz testcase more readable and the AUT task log result of
tomorrow much more easier to debug. In terms of functionality, they do not change anything at all.

Creating a new blitz section makes ``list`` and ``remove`` commands unable to
view/delete autogenerated blitz actions in the previous test section as they only operate
within the domain of a blitz test section. Hence, be particularly cautious when
creating a new blitz test section & do so only after verifying that the earlier test
section looks ok. Following example shows this behaviour of ``list`` and ``remove`` commands
in action:

.. code-block:: console

   (lӓut-l2switch) configure no logging console
   2024-07-10 17:06:30: %LAUT-INFO: +..............................................................................+
   2024-07-10 17:06:30: %LAUT-INFO: :                 Configure 'no logging console' on 'l2switch'                 :
   2024-07-10 17:06:30: %LAUT-INFO: +..............................................................................+

   2024-07-10 17:06:30,010: %UNICON-INFO: +++ l2switch with via 'cli': configure +++
   config term
   Enter configuration commands, one per line.  End with CNTL/Z.
   l2switch(config)#no logging console
   l2switch(config)#end
   l2switch#
   (lӓut-l2switch) list 1
               - configure:
                   device: l2switch
                   command: ['no logging console']
   (lӓut-l2switch) blitz_section new
   (lӓut-l2switch) list 1
   (lӓut-l2switch) remove 1
   (lӓut-l2switch)
   (lӓut-l2switch) save pyats/testcases/TC1.yaml
   LAUT-INFO: File 'pyats/testcases/TC1.yaml' saved successfully
   (lӓut-l2switch)

After viewing the file, we can observe that the *'configure'* action still
exists under 'default' test section & no blitz actions are present in the newly created
test section 'new':

.. code-block:: yaml

   # TC1.yaml
   # LAUT Generated testcase

   TC1:
       source:
           pkg: genie.libs.sdk
           class: triggers.blitz.blitz.Blitz
       devices: ['l2switch']
       test_sections:
           - default:
               - configure:
                   device: l2switch
                   command: ['no logging console']
           - new:

However, ``remove -a`` is not affected by test sections and removes
the entire set of autogenerated blitz action snippets across all test sections.
Observe in the below example how ``remove -a`` wiped out everything that ``save``
command returns an error saying *nothing* was found:

.. code-block:: console

   (lӓut-l2switch) configure no logging console
   2024-07-10 17:06:30: %LAUT-INFO: +..............................................................................+
   2024-07-10 17:06:30: %LAUT-INFO: :                 Configure 'no logging console' on 'l2switch'                 :
   2024-07-10 17:06:30: %LAUT-INFO: +..............................................................................+

   2024-07-10 17:06:30,010: %UNICON-INFO: +++ l2switch with via 'cli': configure +++
   config term
   Enter configuration commands, one per line.  End with CNTL/Z.
   l2switch(config)#no logging console
   l2switch(config)#end
   l2switch#
   (lӓut-l2switch) list 1
               - configure:
                   device: l2switch
                   command: ['no logging console']
   (lӓut-l2switch) blitz_section new
   (lӓut-l2switch) list 1
   (lӓut-l2switch) remove -a
   (lӓut-l2switch)
   (lӓut-l2switch) save pyats/testcases/TC1.yaml
   LAUT-ERR: No test sections found, not saving
   (lӓut-l2switch)
